<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <META HTTP-EQUIV="Pragma" CONTENT="no-cache">
    
    <title>TypeFacet Autokern Manual</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    

<style type="text/css">
<!--

header {
	position: static;
}

header div {
	padding-bottom: 10px;
}

section div {
	color: #000;
}

section div,
section ul {
	padding-top: 10px;
}

section pre {
	margin-top: 10px;
}

section div,
section ul li {
	color: #000;
	font: 16px;
}

section h3 {
	padding-top: 35px;
	margin-bottom: 0;
}

section b {
	color: #333;
}

section ul {
	margin-bottom: 0;
}

section {
/*
    width: auto;
	float: none;
*/
}

/*
.mini-links a {
	padding-right: 1px;
}

section pre {
  font-size: 10px;
}
*/

-->
</style>

  </head>
  <body>

    <div class="wrapper">
    
      <header>
        <h1>TypeFacet</h1>
        <p><a href="http://charlesmchen.github.com/typefacet/topics/autokern/index.html"><img src="images/typefacet logo.120.png" /></a></p>
        <p class="view"><a href="http://charlesmchen.github.com/typefacet/topics/autokern/index.html">TypeFacet Autokern Home</a></p>
        <ul>
          <li><a href="typefacet-autokern-manual.html">Autokern Manual</a></li>
          <li><a href="typefacet-autokern-install.html">Installation Guide</a></li>
          <li><a href="typefacet-autokern-faq.html">Autokern FAQ</a></li>
          <li><a href="typefacet-autokern-links.html">Links</a></li>
        </ul>
        <p class="view"><a href="https://github.com/charlesmchen/typefacet">View the Project on GitHub</a></p>
        <ul>
          <li><a href="https://github.com/charlesmchen/typefacet/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/charlesmchen/typefacet/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/charlesmchen/typefacet">View On <strong>GitHub</strong></a></li>
        </ul>
        
<div>
 <a href="http://typefacet.com/">TypeFacet Blog</a>
</div>

<div class="social">

<div>
<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://charlesmchen.github.com/typefacet/topics/autokern/index.html" data-text="Typefacet Autokern" data-via="cmchen" data-hashtags="typefacet">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</div>

<div>
<iframe src="http://markdotto.github.com/github-buttons/github-btn.html?user=charlesmchen&amp;repo=typefacet&amp;type=watch&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="170px" height="30px"></iframe>
</div>

</div>
        
      </header>
      
      <section>
            
        <h2>TypeFacet Autokern Manual</h2>

	<div>
	<b>Warning</b>: 
	Typefacet Autokern is finicky.
	You will not receive usable results if you do not read this manual.
	</div>




	<h3>
		Terminology
	</h3>
	
	<div>
		<embed src="svg/example-glyph-anatomy-0.svg" type="image/svg+xml" />
	</div>

	<div>
	For the purposes of kerning, a glyph has the following elements:
	</div>
	<ul>
		<li>
			<B>Contour</B>, a path defined by a series of on-points and Bezier control points.
		</li>
		<li>
			<B>LSB</B>, the <b>Left Side Bearing</b>.  This is the distance from the <b>origin</b> (0) to the left <b>x-extrema</b>.  This may be negative.
		</li>
		<li>
			<B>RSB</B>, the <b>Right Side Bearing</b>.  This is the distance from the <b>x-advance</b> to the right <b>x-extrema</b>.  This may be negative.
		</li>
		<li>
			<B>x-extrema</B>, the minimum and maximum x values.  May not correspond to any on-point or bezier control point of a contour.
		</li>
		<li>
			<B>x-advance</B>, the default (unkerned) width of the glyph.
		</li>
	</ul>
	
	<div>
		<embed src="svg/example-glyph-anatomy-1.svg" type="image/svg+xml" />
	</div>
	
	<div>
		When kerning a given pair of glyphs, we have the following elements:
	</div>
	<ul>
		<li>
			<B>Kerning value</B>, the adjustment to the spacing defined by the side-bearings.  
			May be positive or negative. 
			In the example above, a large negative kerning value draws the two glyphs closer together.
		</li>
		<li>
			<B>x-extrema overlap</B>, the overlap of the glyph's x-extrema. 
			 Does not imply the overlap of contours.
		</li>
	</ul>
		
	
	
	
	
	<h3>
		Installation
	</h3>
	<div>
		Download TypeFacet and its dependencies.  See the <a href="typefacet-autokern-install.html">Installation Guide</a>.
	</div>


	
	
	
	
	<h3>
		Overview
	</h3>

	<ul>
		<li>
			TypeFacet Autokern reads a .UFO file and outputs a modified .UFO file.  Autokern only modifies the kerning values and (by default) the glyph side bearings.
		</li>
		<li>
			There is no "correct" default behavior.  
			Different font styles are kerned in different ways.  
			Kerning is also dependent on the proclivities of the type designer.
			You will need to tune Autokern's arguments to arrive at a satisfactory result.
		</li>
		<li>
			Autokern's performance is very dependent on its arguments.  
			For example, the <b>--precision-ems</b> argument also has a significant effect on performance. 
			Values smaller than the default (0.005) are more accurate but slower.
		</li>
		<li>
			Also, certain logging configurations (for example, the <b>--write-kerning-pair-logs</b>and <b>--log-basic-pairs</b> arguments)
				are slow and should probably not be used when kerning an entire font.
			Instead, when tuning Autokern's arguments 
				use one of the <b>--kern-samples-only</b>, <b>--glyph-pairs-to-kern</b> or <b>--glyphs-to-kern</b> arguments 
			to kern just a subset of glyphs or glyph pairs.  
			This is far faster than processing the entire font.
		</li>
	</ul>






	<h3>
		Invoking TypeFacet Autokern
	</h3>

	<div>
		TypeFacet Autokern can only be used from the command line.
	</div>
	<div>
		As described in the <a href="typefacet-installation.html">Installation Guide</a>, 
		TypeFacet Autokern's dependencies must be append to the Python path.
		Here's an example of how to invoke TypeFacet Autokern with the -h argument.
	</div>
<pre>
Mac:
env PYTHONPATH=dependencies/robofab:dependencies/pystache:dependencies/svgwrite:python/src-main python python/src-main/autokern/Autokern.py -h

Windows:
set PYTHONPATH=%PYTHONPATH%;dependencies/robofab;dependencies/pystache;dependencies/svgwrite
python python/src-main/autokern/Autokern.py -h
</pre>
	<div>
		The <b>-h</b> help argument will print the usage message which describes all of Autokern's arguments.
	</div>
	<div>
		The examples below will only describe the arguments to use.  Replace -h in the example above with new arguments.
	</div>






<h3>
	Using Autokern's Logs
</h3>
<div>
	There are two ways to review Autokern's results.  
	You can open the output .ufo file in a font editor. 
	A more convenient alternative is to look at Autokern's HTML logs.  
</div>
<div>
	To activate Autokern's logs, set the <b>--log-path</b> argument.
</div>




<h3>
	How to Tune Autokern Arguments 
</h3>
<div>
	Autokerning an entire font is slow.  
	When tuning Autokern's configuration, you will usually only want to kern a limited set of glyphs or glyph pairs.
</div>
<div>
	To tune an argument:
</div>
<ul>
	<li>
		Run Autokern 
	</li>
	<li>
		Refresh the browser window that contains the HTML log.
	</li>
	<li>
		Repeat as necessary, tuning Autokern's arguments one by one, as described below.
	</li>
</ul>
<div>
	The key to tuning is to use the most appropriate logs.
</div>
<div>
	The "sample texts" log (<a href="league_gothic/sample_texts.html">example</a>)
	is particularly useful when tuning arguments.
	Use the <b>--kern-samples-only</b> argument 
	to kern just the pairs that are used in the sample texts.  
	Use the <b>--extra-sample-texts</b> argument to add to the built-in sample texts.
</div>
<div>
	The <b>--write-kerning-pair-logs</b> argument will activate the "kerning pair" logs
	which document the kerning process in detail in a separate log file for each kerning pair.
	<a href="autokern-pair-example-0.html">Example</a>.
	Combine this with the <b>--glyph-pairs-to-kern</b> or <b>--write-kerning-pair-logs</b> arguments
	to kern just a specific set of glyphs or glyph pairs.
</div>










	<h3>
		Step 0: Getting started
	</h3>

	<div>
		Let's begin without an empty configuration.
	</div>

<pre>
# See "Invoking TypeFacet Autokern" above for example of how to append dependencies to the Python path.
# All arguments should be one line.
Autokern.py \
	--ufo-src-path "theleagueof-league-gothic-4f9ff8d/source/League Gothic.ufo" \
	--ufo-dst-path "out/League Gothic-kerned.ufo" \
	--min-distance-ems 0.00 \
	--max-distance-ems 0.00 \
	--max-x-extrema-overlap-ems 0.0 \
	--intrusion-tolerance-ems 0.0 \
	--precision-ems 0.005 \
	--log-path logs \
	--kern-samples-only 
</pre>


<div>
	Consult the "sample texts" log.  All glyphs should be kerned with zero space, ie. just barely touching each other.
</div>








	<h3>
		Step 1: the --min-distance-ems argument
	</h3>

	<div>
		The <b>--min-distance-ems</b> argument sets a lower bound on how close the contours of the two glyphs can be.
	</div>
	<div>
		Tune the <b>--min-distance-ems</b> value by
		kerning a pair of glyphs such as T vs. T, t vs. t, f vs. T or r vs. f 
		whose profiles usually meet at the endpoints of two strokes.
	</div>
	<div>
		Note: Set the <b>--min-distance-ems</b> and <b>--max-distance-ems</b> arguments to the same value for now.
	</div>

	<div>
		<embed src="svg/example-min-distance-0.svg" type="image/svg+xml" />
	</div>

<div>
	To kern just T vs. T, use the following arguments:
</div>

<pre>
# See "Invoking TypeFacet Autokern" above for example of how to append dependencies to the Python path.
# All arguments should be one line.
Autokern.py \
	--ufo-src-path "theleagueof-league-gothic-4f9ff8d/source/League Gothic.ufo" \
	--ufo-dst-path "out/League Gothic-kerned.ufo" \
	--min-distance-ems 0.04 \ <-- Tune these arguments together using the same value
	--max-distance-ems 0.04 \ <-- Tune these arguments together using the same value
	--max-x-extrema-overlap-ems 0.0 \
	--intrusion-tolerance-ems 0.0 \
	--precision-ems 0.005 \
	--log-path logs \
	--glyph-pairs-to-kern T T \
	--write-kerning-pair-logs
</pre>

<div>
	To kern a T vs. T, t vs. t, f vs. T and r vs. f , use the following arguments:
</div>

<pre>
# See "Invoking TypeFacet Autokern" above for example of how to append dependencies to the Python path.
# All arguments should be one line.
Autokern.py \
	--ufo-src-path "theleagueof-league-gothic-4f9ff8d/source/League Gothic.ufo" \
	--ufo-dst-path "out/League Gothic-kerned.ufo" \
	--min-distance-ems 0.04 \ <-- Tune these arguments together using the same value
	--max-distance-ems 0.04 \ <-- Tune these arguments together using the same value
	--max-x-extrema-overlap-ems 0.0 \
	--intrusion-tolerance-ems 0.0 \
	--precision-ems 0.005 \
	--log-path logs \
	--kern-samples-only \
	--extra-sample-texts "ttrfTT"
</pre>





	<h3>
		Step 2: the --max-distance-ems argument
	</h3>

	<div>
		The <b>--max-distance-ems</b> defines the normal spacing between two glyphs.
		It sets an upper bound on how far apart the two glyphs can be.
	</div>
	<div>
		Tune the <b>--max-distance-ems</b> value by
		kerning a pair of glyphs such as N vs. N, which have straight, uninterrupted profiles.
	</div>
	<div>
		If you aren't kerning a sans-serif font, your N may not have straight sides.  
		You may have to use the "vertical line" glyph ("bar", unicode 0x7c) instead.
	</div>

	<div>
		<embed src="svg/example-max-distance-0.svg" type="image/svg+xml" />
	</div>

<div>
	To kern just N vs. N, use the following arguments:
</div>

<pre>
# See "Invoking TypeFacet Autokern" above for example of how to append dependencies to the Python path.
# All arguments should be one line.
Autokern.py \
	--ufo-src-path "theleagueof-league-gothic-4f9ff8d/source/League Gothic.ufo" \
	--ufo-dst-path "out/League Gothic-kerned.ufo" \
	--min-distance-ems 0.04 \
	--max-distance-ems 0.1 \ <-- Tune this value
	--max-x-extrema-overlap-ems 0.0 \
	--intrusion-tolerance-ems 0.0 \
	--precision-ems 0.005 \
	--log-path logs \
	--kern-samples-only \
	--extra-sample-texts "||NNnnOOoo"
</pre>




	<h3>
		Step 3: the --intrusion-tolerance-ems argument
	</h3>
<div>
	The <b>--intrusion-tolerance-ems</b> argument defines the maximum amount to which the glyphs can "intrude" into the spacing between them.
</div>
<div>
	For example, if you are kerning a serif font, your results for the N vs. N kerning (see above) ought to look something like this:
</div>

	<div>
		<embed src="svg/example-max-distance-1.svg" type="image/svg+xml" />
	</div>

<div>
	This is wrong.  
	The <b>--max-distance-ems</b> argument should be used to specify the distance between 
		glyph's bodies, not small details like serifs. 
	The serifs should intrude into the spacing between the glyphs.
</div>
	<div>
		<embed src="svg/example-max-distance-2.svg" type="image/svg+xml" />
	</div>
<div>
	The <b>--intrusion-tolerance-ems</b> argument is crucial and should be tuned with care.  
	As a rule, it should be as large as necessary and no larger.
</div>
<div>
	A good point of departure are pairs such as A vs. A or O vs. O which should pull towards each other. 
	You should also review the entirety of the "sample texts" log.
</div>

<pre>
# See "Invoking TypeFacet Autokern" above for example of how to append dependencies to the Python path.
# All arguments should be one line.
Autokern.py \
	--ufo-src-path theleagueof-linden-hill-a3f7ae6/source/Linden Hill.ufo \
	--ufo-dst-path out/Linden Hill-kerned.ufo \
	--min-distance-ems 0.04 \
	--max-distance-ems 0.1 \
	--max-x-extrema-overlap-ems 0.0 \
	--intrusion-tolerance-ems 0.1 \ <-- Tune this value
	--precision-ems 0.005 \
	--log-path logs \
	--kern-samples-only \
	--extra-sample-texts "NNOOAA"
</pre>
<div>
	Note: intrusion is limited by the <b>--min-distance-ems</b> argument, so intrusion will never cause contours to overlap.
</div>








	<h3>
		Step 4: the --max-x-extrema-overlap-ems argument
	</h3>

	<div>
		The <b>--max-x-extrema-overlap-ems</b> argument limits the extent to which the x-extrema of glyphs can overlap.  
		Do not confuse x-extrema overlap with contour overlap.
	</div>
	<div>
		<embed src="svg/example-extrema-overlap-0.svg" type="image/svg+xml" />
	</div>

	<div>
		Tune the <b>--max-x-extrema-overlap-ems</b> value by
		kerning a pair of glyphs such as V vs. A, T vs. a, L vs. T, etc. whose x-extrema do not collide.
	</div>


<pre>
# See "Invoking TypeFacet Autokern" above for example of how to append dependencies to the Python path.
# All arguments should be one line.
Autokern.py \
	--ufo-src-path theleagueof-linden-hill-a3f7ae6/source/Linden Hill.ufo \
	--ufo-dst-path out/Linden Hill-kerned.ufo \
	--min-distance-ems 0.04 \
	--max-distance-ems 0.1 \
	--max-x-extrema-overlap-ems 0.1 \ <-- Tune this value
	--intrusion-tolerance-ems 0.1 \ 
	--precision-ems 0.005 \
	--log-path logs \
	--kern-samples-only \
	--extra-sample-texts "WAVTaLTLY"
</pre>

<div>
	If the <b>--max-x-extrema-overlap-ems</b> argument is negative, Autokern
	will maintain a minimum spacing between the glyphs' x-extrema.
</div>






	<h3>
		Further Tuning
	</h3>

	<ul>
		<li>
			To kern an entire font, remove the <b>--kern-samples-only</b>, 
			<b>--glyph-pairs-to-kern</b> or <b>--glyphs-to-kern</b> arguments.
		</li>
		<li>
			When kerning an entire font, do not use the <b>--write-kerning-pair-logs</b> argument 
			as writing a log file for each kerning pair combination will be very slow.
		</li>
		<li>
			Use the <b>--disparity-log-count</b> argument to write "disparity" logs which document the largest differences 
			between the original kerning and Autokern's kerning.
			<a href="league_gothic_disparities/disparity-0.html">Example</a>.
		</li>
		<li>
			If the <b>--do-not-modify-side-bearings</b> argument is present,
			Autokern will preserve the original side bearings.
		</li>
		<li>
			By default, Autokern will not allow negative side bearings, ie. within the x-extrema of a glyph.
			The <b>--allow-negative-side-bearings</b> argument enables such side bearings.
		</li>
		<li>
			If the <b>--kerning-threshold-ems</b> argument is present, 
			Autokern will discard kerning values less than this value.
		</li>
		<li>
			If the <b>--max-kerning-pairs</b> argument is present, 
			Autokern will only output the N largest kerning values and discard the rest.
		</li>
		<li>
			If the <b>--log-basic-pairs</b> argument is present, 
			Autokern will write the "basic pairs" logs which can be used for proofing.
			NOTE: these logs are very time-consuming to generate.
		</li>
		<li>
			In addition to the <b>--max-x-extrema-overlap-ems</b> argument, 
				you can use the <b>--x-extrema-overlap-scaling</b> argument to tune x-extrema overlap.
			To scale down x-extrema overlaps to 1/3 of their normal size, 
			use a <b>--x-extrema-overlap-scaling</b> value of 0.333.
			<b>--x-extrema-overlap-scaling</b> does not effect kerning pairs that do not have x-extrema overlap.
		</li>
		<li>
			The <b>--tracking</b> argument can be used to add a constant value to all kerning values.
		</li>
		<li>
			The <b>--ignore-x-extrema-overlap-outside-ascender</b> argument can be used to 
			ignore x-extrema overlap below the baseline or above the ascender.
		</li>
		<li>
			The <b>--glyphs-to-ignore</b> and <b>--glyph-categories-to-ignore</b> arguments can be used to 
			specify a set of glyphs that should not be kerned.  Use the <b>-h</b> usage argument
			for more information.
		</li>
	</ul>

	<h3>
		Per-Category Tuning
	</h3>

	<div>
		The <b>--max-x-extrema-overlap-ems-per-category</b>, 
		<b>--max-distance-ems-per-category</b>,
		<b>--min-distance-ems-per-category</b>,
		<b>--intrusion-tolerance-ems-per-category</b>
		and 
		<b>--tracking-ems-per-category</b>,
		arguments allow the user to use different values for different unicode categories,
		for example: punctuation (P*) or currency symbols (Sc).  
	</div>
	<div>
		The user sets these values using a set of (category, value) rules.
	</div>
<pre>
# Example:
# Require a minimum x-extrema offset of -0.025 em 
# for all punctuation, marks and symbols:
--max-x-extrema-overlap-ems-per-category P* -0.025 M* -0.025 S* -0.025

# Example:
# Apply a --max-distance-ems value of 0.050 em 
# to all currency symbols.
--max-distance-ems-per-category Sc 0.050 
</pre>
	<div>
		These categories are defined by the unicode standard.
		See <a href="http://www.unicode.org/reports/tr44/tr44-4.html#General_Category_Values">the Unicodedata documentation</a> for a list of glyph categories.
		
	</div>
	<div>
		Unicode glyph categories (ie. Lu = Letter, Uppercase) 
		have a major (ie. Letter) and minor (ie. Uppercase) components.
		You may use an asterisk in the minor component as a wildcard (ie. L* = all Letters).
	</div>
	<div>
		When the user has defined more than one rule that applies to a kerning pair, 
		the last rule in the rule set has precedence.
	</div>
<pre>
# Rule precedence example:
--min-distance-ems 0.030
--min-distance-ems-per-category P* 0.015 M* 0.025 S* 0.025 Sc 0.050 

# No per-category rule applies, so the default --min-distance-ems 0.030 applies.
A vs. T 

# The punctuation wildcard rule (P*) matches period, so it applies: 0.015.
A vs. period

# The symbol wildcard rule (S*) and the currency symbol rule (Sc) both match dollar,
# so the currency symbol rule applies since it is defined later in the rule set: 0.050.
A vs. dollar

# The punctuation wildcard rule (S*) matches period 
# the and the currency symbol rule (Sc) matches dollar,
# so the currency symbol rule applies since it is defined later in the rule set: 0.050.
period vs. dollar
</pre>
	

	<div>
		<a href="index.html">TypeFacet Autokern Home</a>
	</div>

<a name="bottom"> </a>

      </section>
      
      <footer>
<!--
        <p>This project is maintained by <a href="https://github.com/charlesmchen">charlesmchen</a></p>
-->
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
